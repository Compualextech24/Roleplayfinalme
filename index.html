<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mili & Friends Chat - Edici√≥n Prohibida</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background-color: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        #chat-container {
            width: 100%;
            max-width: 400px;
            height: 95vh;
            background: white;
            display: flex;
            flex-direction: column;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(255, 64, 129, 0.3);
            overflow: hidden;
            position: relative;
        }

        #selector-screen {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: #050505;
            z-index: 100;
            display: flex;
            flex-direction: column;
            padding: 15px;
            overflow-y: auto;
            gap: 15px;
        }

        .selector-title {
            text-align: center;
            color: #ff4081;
            margin: 10px 0;
            font-size: 1.4rem;
            font-style: italic;
            border-bottom: 2px solid #ff4081;
            padding-bottom: 10px;
        }

       .char-card img {
            width: 100%; 
            height: 100%;
            object-fit: contain; 
            position: absolute;
            top: 0; left: 0;
            z-index: 1;
            background-color: #000; 
        }

        .char-card {
            position: relative;
            background: #000;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(0,0,0,0.5);
            cursor: pointer;
            transition: 0.3s;
            min-height: 300px; 
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
        }

       .char-overlay {
            position: relative;
            z-index: 2;
            width: 100%;
            padding: 15px;
            background: linear-gradient(to top, rgba(0,0,0,0.9) 20%, transparent 100%);
            color: white;
            text-align: center; 
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        header {
            padding: 12px 15px;
            background: #f8bbd0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #f48fb1;
            z-index: 10;
        }

        .profile { display: flex; align-items: center; gap: 12px; }
        .profile img { width: 45px; height: 45px; border-radius: 50%; object-fit: cover; border: 2px solid white; }
        .profile h1 { font-size: 16px; color: #880e4f; font-weight: bold; }
        
        .online-status { display: flex; align-items: center; gap: 4px; font-size: 10px; color: #ad1457; font-weight: bold; }
        .dot { width: 8px; height: 8px; background: #4caf50; border-radius: 50%; box-shadow: 0 0 5px #4caf50; }

        #suggestions-container {
            display: flex;
            gap: 8px;
            padding: 10px;
            overflow-x: auto;
            background: white;
            border-top: 1px solid #eee;
        }

        .suggestion-btn {
            padding: 10px 18px;
            background: #fff1f6;
            color: #d81b60;
            border: 1px solid #f48fb1;
            border-radius: 20px;
            font-size: 13px;
            font-weight: bold;
            cursor: pointer;
            white-space: nowrap;
        }

        #messages-area {
            flex: 1;
            position: relative;
            overflow: hidden;
            background-color: #fff;
        }

        .bg-photo {
            position: absolute;
            top: 60%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 95%;
            opacity: 0.5;
            z-index: 0;
            pointer-events: none;
        }
        
        #messages {
            position: relative;
            z-index: 1;
            height: 100%;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .bubble { padding: 12px 16px; max-width: 85%; font-size: 15px; border-radius: 18px; line-height: 1.4; }
        .user { align-self: flex-end; background: #ff4081; color: white; border-bottom-right-radius: 4px; }
        .bot { align-self: flex-start; background: #f1f0f0; color: #222; border-bottom-left-radius: 4px; }
        
        #typing { font-size: 11px; color: #ad1457; padding: 5px 20px; font-style: italic; display: none; }
        
        footer { 
            background: white; 
            z-index: 10; 
            border-top: 1px solid #eee; 
            padding: 5px 10px;
        }

        form { 
            display: flex; 
            gap: 8px; 
            align-items: center; 
            background: #f0f2f5; 
            border-radius: 20px; 
            padding: 3px 12px; 
        }

        input { 
            flex: 1; 
            padding: 6px;
            border: none; 
            background: transparent; 
            outline: none; 
            color: #d81b60; 
            font-weight: bold; 
            font-size: 14px;
        }
        
        button#send-btn { background: none; border: none; color: #ff4081; cursor: pointer; }
        
        .nav-btn { background: none; border: none; font-size: 20px; cursor: pointer; }

        @media (max-width: 480px) {
            body { padding: 0; align-items: stretch; }
            #chat-container { max-width: 100%; height: 100vh; border-radius: 0; box-shadow: none; }
            #selector-screen { padding: 10px; gap: 12px; }
            .selector-title { font-size: 1.2rem; margin: 5px 0; }
            .char-card { min-height: 280px; }
            header { padding: 10px 12px; }
            .profile img { width: 40px; height: 40px; }
            .profile h1 { font-size: 14px; }
            .bg-photo { width: 100%; max-width: 100%; }
            #messages { padding: 10px; }
            .bubble { max-width: 80%; font-size: 14px; }
            #suggestions-container { padding: 8px; gap: 6px; }
            .suggestion-btn { padding: 8px 14px; font-size: 12px; }
        }
    </style>
</head>
<body>

<div id="chat-container">
    <div id="selector-screen">
        <h1 class="selector-title">¬øA qu√© zorra quieres hoy? üòà</h1>
        <div class="char-card" onclick="selectBot('mili')">
            <img src="Secretariamili.PNG">
            <div class="char-overlay"><h2>Mili ‚ú®</h2><span>La secretaria m√°s puta</span></div>
        </div>
        <div class="char-card" onclick="selectBot('naomi')">
            <img src="Momnaomi.PNG">
            <div class="char-overlay"><h2>Naomi Carter üé∞</h2><span>Madre soltera guarra</span></div>
        </div>
        <div class="char-card" onclick="selectBot('asuna')">
            <img src="Studianteosuna.PNG">
            <div class="char-overlay"><h2>Asuna Saito üå∏</h2><span>Estudiante zorra</span></div>
        </div>
    </div>

    <header>
        <div class="profile">
            <img src="" id="header-img">
            <div>
                <h1 id="header-name"></h1>
                <div class="online-status"><span class="dot"></span> En l√≠nea</div>
            </div>
        </div>
        <div>
            <button class="nav-btn" id="voice-toggle" onclick="toggleVoice()">üîä</button>
            <button class="nav-btn" onclick="showSelector()">üè†</button>
            <button class="nav-btn" onclick="clearChat()">üóëÔ∏è</button>
        </div>
    </header>

    <div id="messages-area">
        <img src="" class="bg-photo" id="bg-img">
        <div id="messages"></div>
    </div>
    
    <div id="typing">Escribiendo algo muy guarro...</div>

    <div id="suggestions-container"></div>

    <footer>
        <form id="message-form">
            <input type="text" id="message-input" placeholder="Hazla gemir..." required>
            <button type="submit" id="send-btn">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
            </button>
        </form>
    </footer>
</div>

<script>
    // üî• APIs CONFIGURADAS üî•
    const HUGGINGFACE_KEY = "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";
    const GOOGLE_TTS_KEY = "AIzaSyCkBZDH5KmGWkdxk1FzaXItUudMiKvsQ5Q";
    
    // Prompts CORTOS para que el audio sea r√°pido y cachondo
    const basePrompt = " Responde SIEMPRE en m√°ximo 2-3 frases cortas. S√© extremadamente directa, guarra, sin filtros. Usa lenguaje vulgar y expl√≠cito. Ve directo al sexo sin rodeos.";

    const characters = {
        mili: {
            name: "Mili ‚ú®", 
            photo: "Secretariamili.PNG",
            voice: "Aoede", // Voz c√°lida y sensual
            prompt: "Eres Mili, secretaria joven y caliente. Dices cosas s√∫per guarras y directas sobre sexo con tu jefe. M√°ximo 2-3 frases." + basePrompt,
            options: ["Mas sucio", "Mas detalles", "Mas extenso"]
        },
        naomi: {
            name: "Naomi Carter üé∞", 
            photo: "Momnaomi.PNG",
            voice: "Charon", // Voz madura y seductora
            prompt: "Eres Naomi, madre soltera madura y muy puta. Hablas con elegancia pero dices cosas MUY guarras. M√°ximo 2-3 frases." + basePrompt,
            options: ["Mas sucio", "Mas detalles", "Mas extenso"]
        },
        asuna: {
            name: "Asuna Saito üå∏", 
            photo: "Studianteosuna.PNG",
            voice: "Puck", // Voz dulce pero traviesa
            prompt: "Eres Asuna, estudiante dulce pero muy zorra en privado. Dices cosas sucias con ternura. M√°ximo 2-3 frases." + basePrompt,
            options: ["Mas sucio", "Mas detalles", "Mas extenso"]
        }
    };

    let currentBot = "mili";
    let chatHistory = [];
    let voiceEnabled = true;
    let audioContext;

    function toggleVoice() {
        voiceEnabled = !voiceEnabled;
        document.getElementById('voice-toggle').textContent = voiceEnabled ? "üîä" : "üîá";
    }

    // Convertir PCM16 a WAV para reproducci√≥n
    function pcmToWav(pcmData, sampleRate) {
        const buffer = new ArrayBuffer(44 + pcmData.length * 2);
        const view = new DataView(buffer);
        const writeString = (offset, string) => {
            for (let i = 0; i < string.length; i++) view.setUint8(offset + i, string.charCodeAt(i));
        };
        writeString(0, 'RIFF');
        view.setUint32(4, 32 + pcmData.length * 2, true);
        writeString(8, 'WAVE');
        writeString(12, 'fmt ');
        view.setUint32(16, 16, true);
        view.setUint16(20, 1, true);
        view.setUint16(22, 1, true);
        view.setUint32(24, sampleRate, true);
        view.setUint32(28, sampleRate * 2, true);
        view.setUint16(32, 2, true);
        view.setUint16(34, 16, true);
        writeString(36, 'data');
        view.setUint32(40, pcmData.length * 2, true);
        for (let i = 0; i < pcmData.length; i++) view.setInt16(44 + i * 2, pcmData[i], true);
        return buffer;
    }

    // üî• FUNCI√ìN PARA GENERAR VOZ SEXY CON GOOGLE TTS üî•
    async function playSexyVoice(text, voiceName) {
        if (!voiceEnabled) return;
        try {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp-tts:generateContent?key=${GOOGLE_TTS_KEY}`;
            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{ 
                        parts: [{ text: text }] 
                    }],
                    generationConfig: {
                        responseModalities: ["AUDIO"],
                        speechConfig: {
                            voiceConfig: { 
                                prebuiltVoiceConfig: { voiceName: voiceName } 
                            }
                        }
                    }
                })
            });

            const result = await response.json();
            const audioDataB64 = result.candidates[0].content.parts[0].inlineData.data;
            const audioBuffer = Uint8Array.from(atob(audioDataB64), c => c.charCodeAt(0));
            
            if (!audioContext) audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const pcmArray = new Int16Array(audioBuffer.buffer);
            const wavBuffer = pcmToWav(pcmArray, 24000);
            
            const decodedData = await audioContext.decodeAudioData(wavBuffer);
            const source = audioContext.createBufferSource();
            source.buffer = decodedData;
            source.connect(audioContext.destination);
            source.start(0);
        } catch (e) {
            console.error("Error en voz:", e);
        }
    }

    function selectBot(botKey) {
        currentBot = botKey;
        const bot = characters[botKey];
        document.getElementById('header-name').textContent = bot.name;
        document.getElementById('header-img').src = bot.photo;
        document.getElementById('bg-img').src = bot.photo;
        document.getElementById('selector-screen').style.display = 'none';
        
        const sugContainer = document.getElementById('suggestions-container');
        sugContainer.innerHTML = '';
        bot.options.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'suggestion-btn';
            btn.textContent = opt;
            btn.onclick = () => {
                document.getElementById('message-input').value = opt;
                document.getElementById('message-form').dispatchEvent(new Event('submit'));
            };
            sugContainer.appendChild(btn);
        });

        chatHistory = []; 
        renderMessages();
    }

    function showSelector() { document.getElementById('selector-screen').style.display = 'flex'; }

    function renderMessages() {
        const messagesDiv = document.getElementById('messages');
        messagesDiv.innerHTML = '';
        chatHistory.forEach(msg => {
            const div = document.createElement('div');
            div.className = `bubble ${msg.role === 'user' ? 'user' : 'bot'}`;
            div.textContent = msg.content;
            messagesDiv.appendChild(div);
        });
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

    async function getResponse() {
        document.getElementById('typing').style.display = 'block';
        try {
            // üî• OBTENER RESPUESTA DE HUGGING FACE (SIN CENSURA) üî•
            const response = await fetch("https://api-inference.huggingface.co/models/NousResearch/Hermes-3-Llama-3.1-70B/v1/chat/completions", {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${HUGGINGFACE_KEY}`
                },
                body: JSON.stringify({
                    model: "NousResearch/Hermes-3-Llama-3.1-70B",
                    messages: [
                        {role: "system", content: characters[currentBot].prompt},
                        ...chatHistory.slice(-10)
                    ],
                    temperature: 0.95,
                    max_tokens: 150,
                    stream: false
                })
            });

            const data = await response.json();
            
            if (data.error) {
                console.error('Error HF:', data.error);
                chatHistory.push({ role: 'assistant', content: 'Perd√≥n papi, hubo un error üòò' });
            } else {
                const botMessage = data.choices[0].message.content;
                chatHistory.push({ role: 'assistant', content: botMessage });
                
                // üî• REPRODUCIR VOZ AUTOM√ÅTICAMENTE üî•
                await playSexyVoice(botMessage, characters[currentBot].voice);
            }
            
            renderMessages();
        } catch (e) { 
            console.error('Error completo:', e);
            chatHistory.push({ role: 'assistant', content: 'Uff, algo sali√≥ mal bb... üíã' });
            renderMessages();
        }
        finally { 
            document.getElementById('typing').style.display = 'none'; 
        }
    }

    document.getElementById('message-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const input = document.getElementById('message-input');
        if(!input.value.trim()) return;
        
        // Activar AudioContext en primera interacci√≥n
        if (!audioContext) {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
        }
        if (audioContext.state === 'suspended') {
            audioContext.resume();
        }
        
        chatHistory.push({ role: 'user', content: input.value.trim() });
        input.value = '';
        renderMessages();
        await getResponse();
    });

    window.clearChat = function() { 
        if(confirm("¬øBorrar tus pecados? üòà")) { 
            chatHistory = []; 
            renderMessages(); 
        } 
    }
    
    selectBot('mili');
</script>
</body>
</html>
